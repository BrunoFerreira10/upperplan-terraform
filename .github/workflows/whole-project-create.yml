name: "C1 - Whole project: Create"
run-name: "C1 - Whole project: Create"

on: 
  workflow_dispatch:
    inputs:
      CONFIRMATION:
        required: true
        type: string
        description: "Vazio aborta. Qualquer valor confirma."

## -----------------------------------------------------------------------------
## Create project 
## -----------------------------------------------------------------------------
jobs:
  ## - Nivel 1 -----------------------------------------------------------------

  github_sync:
    uses: ./.github/workflows/single-sub-project-run.yml
    with:
      RESOURCE: '1a'
    secrets: inherit

  ## - Nivel 2 -----------------------------------------------------------------

  vpc:
    needs: [
      github_sync
    ]
    uses: ./.github/workflows/single-sub-project-run.yml
    with:
      RESOURCE: '2a'
    secrets: inherit

  nat_gateway:
    needs: [
      github_sync,
      vpc
    ]
    uses: ./.github/workflows/single-sub-project-run.yml
    with:
      RESOURCE: '2a1'
    secrets: inherit

  acm:
    needs: [
      github_sync
    ]
    uses: ./.github/workflows/single-sub-project-run.yml
    with:
      RESOURCE: '2b'
    secrets: inherit

  cloudwatch_logs:
    needs: [
      github_sync
    ]
    uses: ./.github/workflows/single-sub-project-run.yml
    with:
      RESOURCE: '2c'
    secrets: inherit
  
  ecr:
    needs: [
      github_sync
    ]
    uses: ./.github/workflows/single-sub-project-run.yml
    with:
      RESOURCE: '2d'
    secrets: inherit

  ## - Nivel 3 -----------------------------------------------------------------

  elb:
    needs: [
      github_sync, 
      vpc,
      acm
    ]
    uses: ./.github/workflows/single-sub-project-run.yml
    with:
      RESOURCE: '3a'
    secrets: inherit

  rds:
    needs: [
      github_sync, 
      vpc
    ]
    uses: ./.github/workflows/single-sub-project-run.yml
    with:
      RESOURCE: '3b'
    secrets: inherit

  efs:
    needs: [
      github_sync, 
      vpc
    ]
    uses: ./.github/workflows/single-sub-project-run.yml
    with:
      RESOURCE: '3c'
    secrets: inherit  

  ## - Nivel 4 -----------------------------------------------------------------

  container_image_builder:
    needs: [
      github_sync,
      elb
    ]
    uses: ./.github/workflows/single-sub-project-run.yml
    with:
      RESOURCE: '4a'
    secrets: inherit

  ## - Nivel 5 -----------------------------------------------------------------

  ecs_service:
    needs: [
      github_sync,
      vpc,
      elb, rds, efs,
      container_image_builder
    ]
    uses: ./.github/workflows/single-sub-project-run.yml
    with:
      RESOURCE: '5a'
    secrets: inherit

  ## - Nivel 6 -----------------------------------------------------------------

  deploy_container_image:
    needs: [
      github_sync,
      elb
    ]
    uses: ./.github/workflows/single-sub-project-run.yml
    with:
      RESOURCE: '6a'
    secrets: inherit

  ## ---------------------------------------------------------------------------