#!/usr/bin/env bash
trap 'echo ""; echo "Erro no comando ${0}: ${BASH_COMMAND} na linha: ${LINENO}."' ERR

## ---------------------------------------------------------------------------------------------------------------------
## Definir paths
## ---------------------------------------------------------------------------------------------------------------------
SETUP_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
TF_HOME_DIR="$(dirname "$SETUP_DIR")"

## ---------------------------------------------------------------------------------------------------------------------
## Uso do script e verificação dos parâmetros
## ---------------------------------------------------------------------------------------------------------------------
usage() {
  echo ""
  echo "Uso: $0 <ACTION>"
  echo "Exemplos:"
  echo "$0 a"
  echo "$0 d"
  echo ""
}

if [ -z "$1" ]; then
  echo ""
  echo "Erro: nenhuma ação foi informada."
  usage
fi

set -euEo pipefail

## ---------------------------------------------------------------------------------------------------------------------
## Captura os recursos passados como parâmetros
## ---------------------------------------------------------------------------------------------------------------------
ACTION=$(echo "$1" | xargs)

## ---------------------------------------------------------------------------------------------------------------------
## Executa workflow sync-parameter-store.yml
## Parametro 'a' para executar o apply
## Executado remotamente no GitHub Actions
## ---------------------------------------------------------------------------------------------------------------------
. $SETUP_DIR/.scripts/run-workflow.sh sync-parameter-store $ACTION

## ---------------------------------------------------------------------------------------------------------------------